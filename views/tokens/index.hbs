<div class="float-right">
    <a href="/admin/tokens/new" class="btn btn-primary btn-icon-split">
        <span class="icon text-white-50">
            <i class="fas fa-plus"></i>
        </span>
        <span class="text">Generate</span>
    </a>
</div>

{{>tokens_head}}

<div class="list-group">
    {{#unless tokenList}}
    <div class="list-group-item">
        No access tokens have been provisioned. Generate a new token <a href="/admin/tokens/new">here</a>.
    </div>
    {{/unless}}
    {{#each tokenList}}
    <div class="list-group-item">
        <div class="d-flex w-100">
            <h6 class="flex-fill align-self-center">{{description}}</h6>
            <small class="align-self-center">
                {{#if access.timeStr}}
                Last used: <span class="relative-time" data-time="{{access.timeStr}}">{{access.timeStr}}</span>
                {{else}}
                <span>Never used</span>
                {{/if}}
            </small>
            <div class="ml-2 align-self-center">
                <button type="button" class="btn btn-danger btn-sm delete-token-btn" data-token="{{id}}">Delete</button>
            </div>
        </div>
    </div>
    {{/each}}
</div>


<div class="card mt-4 mb-4">
    <div class="card-body">
        <p>In order to make API requests you either have to use the <code>Authorization</code> Bearer header or the
            <code>
            access_token</code> query parameter.
        </p>

        <pre>$ curl "<span class="cur-base-url" data-origin="">http://127.0.0.1:3000</span>/v1/stats?access_token=&lt;token&gt;"
$ curl "<span class="cur-base-url" data-origin="">http://127.0.0.1:3000</span>/v1/stats" --header "Authorization: Bearer &lt;token&gt;"</pre>

        <div>
            <small>
                <code>&lt;token&gt;</code> is the full access token string without any quoting
            </small>
        </div>

    </div>
</div>

<div class="modal fade" id="deleteToken" tabindex="-1" aria-labelledby="deleteTokenLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="deleteTokenLabel">Delete token</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this token? This action can not be reversed.
            </div>
            <div class="modal-footer">
                <form method="post" action="/admin/tokens/delete">
                    <input type="hidden" name="crumb" value="{{crumb}}">
                    <input type="hidden" id="token-delete" name="token" value="">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>

        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        for (let elm of document.querySelectorAll('.delete-token-btn')) {
            elm.addEventListener('click', e => {
                e.preventDefault();
                document.getElementById('token-delete').value = elm.dataset.token;
                $('#deleteToken').modal('show');
            });
        }

    });
</script>